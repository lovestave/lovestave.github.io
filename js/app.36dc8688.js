(function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],_=0,d=[];_<o.length;_++)s=o[_],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={app:0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var a=n("85ec"),r=n.n(a);r.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("div",[a("div",{class:["content-container",t.sidebar_shown_on_pc_mode?"":"side-hidden-screen"]},[a("ContentView",{attrs:{base_name:t.contentAlbumName,album_friendly_name:t.contentFriendlyName,sidebar_shown_pc:t.sidebar_shown_on_pc_mode},on:{"should-show-sidebar":function(e,n){return"mobile"===n?t.sidebar_shown_on_mobile_mode=e:t.sidebar_shown_on_pc_mode=e},"preview-photo":function(e,n,a,r,i){return t.previewPhoto(e,n,a,r,i)}}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.sidebar_shown_on_mobile_mode,expression:"sidebar_shown_on_mobile_mode"}],staticClass:"sidebar-mobile-mask",on:{click:function(e){t.sidebar_shown_on_mobile_mode=!1}}}),a("div",{class:["sidebar-container",t.sidebar_shown_on_pc_mode?"":"side-hidden-screen",t.sidebar_shown_on_mobile_mode?"sidebar-mobile-shown":""]},[a("Sidebar",{ref:"sidebar",on:{"switch-album":function(t,n){e.contentAlbumName=t,e.contentFriendlyName=n},"should-show-sidebar":function(e,n){return"mobile"===n?t.sidebar_shown_on_mobile_mode=e:t.sidebar_shown_on_pc_mode=e}}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.preview_shown,expression:"preview_shown"}],staticClass:"preview-container"},[a("Preview",{attrs:{current_photo_filename:t.preview_filename,image_list:t.preview_imagelist,index:t.preview_index,current_album_name:t.preview_album_name,catalog_name:t.contentFriendlyName,current_photo:t.preview_current_obj},on:{"hide-preview":function(e){t.preview_shown=!1}}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.password_input_shown,expression:"password_input_shown"}],staticClass:"password-container"},[a("PasswordInput",{ref:"password_input",on:{"submit-password":function(e){return t.checkPassword(e)}}})],1)])},i=[],s=(n("96cf"),n("1da1")),o=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticStyle:{"padding-left":"10px","padding-right":"10px",height:"100%","overflow-y":"auto"},on:{scroll:t.handleScroll}},[a("div",{class:["navbar",t.shouldShowSemiTransparentNavBar?"":"large"]},[a("div",{staticClass:"nav-title"},[t._v(" 照片 ")]),a("div",{staticClass:"left-button-group"},[a("a",{staticClass:"hidden-btn",attrs:{href:"javascript:void(0)"},on:{click:function(){e.raise_event_show_sidebar(!1,"mobile"),e.raise_event_show_sidebar(!1,"pc")}}},[t._v("隐藏")])]),a("div",{staticClass:"right-button-group"},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.logout()}}},[t._v("退出")])])]),a("div",{staticClass:"title1 navtitle",style:{marginTop:"50px",opacity:1-t.shouldShowSemiTransparentNavBar}},[t._v(" 照片 ")]),a("div",{staticClass:"listview",staticStyle:{"margin-top":"5px"}},[a("a",{class:t.get_css_class_list_item("/all"),attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.on_switch_album("/all","图库")}}},[a("span",[t._v("图库")])]),a("a",{class:t.get_css_class_list_item("/recent"),attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.on_switch_album("/recent","最近项目")}}},[a("span",[t._v("最近项目")])]),a("a",{class:t.get_css_class_list_item("/fav"),attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.on_switch_album("/fav","个人收藏")}}},[a("span",[t._v("个人收藏")])])]),a("div",{staticClass:"title2"},[t._v(" 我的相簿 ")]),a("div",{staticClass:"listview"},t._l(t.album_list,(function(e){return a("a",{key:e.name,class:t.get_css_class_list_item(e.name),attrs:{href:"javascript:void(0)"},on:{click:function(n){return t.on_switch_album(e.name,e.friendly_name)}}},[a("div",{staticStyle:{position:"relative"}},[a("div",{staticClass:"list_img",style:{backgroundImage:""===e.preview?"":"url('/api/album-cache/"+e.name+"/"+e.preview+"')"}}),a("span",{staticStyle:{"margin-left":"27px"}},[t._v(t._s(e.friendly_name))])])])})),0)])},c=[];n("f33e"),n("bfe0"),n("99af"),n("d3b7");function l(e){var t=".";return window.enabled_password&&(t=window.miyuki_password),new Promise((function(n,a){fetch("/api/".concat(t,"/").concat(e,".json")).then((function(e){if(e.ok)return n(e.json());throw new Error("Network response was not ok: url")})).catch((function(t){console.error("HTTP Request: /GET "+e+" [FAILED]",t),a(t)}))}))}function u(e){return new Promise((function(t,n){fetch("/api/".concat(e,".json")).then((function(e){if(e.ok)return t(e.json());throw new Error("Network response was not ok: url")})).catch((function(t){console.error("HTTP Request: /GET "+e+" [FAILED]",t),n(t)}))}))}var _={get_secured_json:l,get_json:u},d={name:"Sidebar",data:function(){return{album_list:[],selected_album_name:"/all",shouldShowSemiTransparentNavBar:!1}},methods:{raise_event_show_sidebar:function(e,t){this.$emit("should-show-sidebar",e,t)},on_switch_album:function(e,t){this.$emit("switch-album",e,t),this.selected_album_name=e,window.innerWidth<=1200&&this.raise_event_show_sidebar(!1,"mobile")},get_css_class_list_item:function(e){return e===this.selected_album_name?"selected":""},handleScroll:function(e){console.log(e.srcElement.scrollTop),e.srcElement.scrollTop>=30?this.shouldShowSemiTransparentNavBar=!0:(console.log("ttt"),this.shouldShowSemiTransparentNavBar=!1)},getAlbumList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,_.get_secured_json("get-album");case 2:e.album_list=t.sent;case 3:case"end":return t.stop()}}),t)})))()},logout:function(){localStorage.removeItem("password"),location.reload()}}},p=d,h=n("2877"),m=Object(h["a"])(p,o,c,!1,null,"c940d8be",null),w=m.exports,v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%","overflow-y":"auto"},on:{scroll:e.handleScroll}},[n("div",{staticClass:"cnav"},[n("div",{class:["title","left",e.sidebar_shown_pc?"":"sidebar-hidden"]},[n("span",{staticClass:"title-text"},[e._v(e._s(e.album_friendly_name))])]),n("div",{staticClass:"title right"},[n("span",{staticStyle:{color:"#eee","margin-right":"10px"}},[e._v(e._s(e.photo_count)+"张图片")]),n("button",[e._v("共享")])]),n("div",{staticClass:"back left",staticStyle:{"line-height":"45px",left:"18px",top:"0"},on:{click:function(t){return e.raise_event_show_sidebar(!0,"mobile")}}},[n("i",{staticClass:"larrow",staticStyle:{"border-color":"white"}}),n("span",{staticClass:"backtext"},[e._v("照片")])]),n("div",{class:["back","left","sidebar-hidden-left",e.sidebar_shown_pc?"":"sidebar-hidden"],staticStyle:{"line-height":"45px",left:"18px",top:"0"},on:{click:function(t){return e.raise_event_show_sidebar(!0,"pc")}}},[n("span",{staticClass:"backtext"},[e._v("显示")])])]),n("div",e._l(e.photo_list,(function(t,a){return n("div",{key:a,staticClass:"photo box",style:{backgroundImage:"url('"+e.get_thumbnail_image(t.al,t.name)+"')"},attrs:{"photo-name":t.name},on:{click:function(n){return e.raise_event_show_preview(t.name,e.photo_list,a,t.al,t)}}})})),0)])},f=[],b=n("2909"),g=(n("eacf"),50),y={name:"Content",components:{},props:["base_name","album_friendly_name","sidebar_shown_pc"],data:function(){return{page_count:0,current_page_to_load:0,photo_count:0,photo_list:[],initial_scroll_height:0,response_load_new:!0}},computed:{album_common_prefix:function(){return"/all"===this.base_name?"get-photo-":"/recent"===this.base_name?"get-recent-photo-":"/fav"===this.base_name?"get-fav-photo-":this.base_name+"-get-photo-"},album_get_count_json_name:function(){return this.album_common_prefix+"count"},album_get_image_at_current_page_json_name:function(){return this.album_common_prefix+"page-"+String(this.current_page_to_load)}},watch:{base_name:function(){this.initialize()}},created:function(){},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.initialize();case 1:case"end":return t.stop()}}),t)})))()},methods:{raise_event_show_sidebar:function(e,t){this.$emit("should-show-sidebar",e,t)},raise_event_show_preview:function(e,t,n,a,r){this.$emit("preview-photo",e,t,n,a,r)},load_image:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.response_load_new){t.next=2;break}return t.abrupt("return");case 2:if(e.response_load_new=!1,setTimeout((function(){e.response_load_new=!0}),1e3),!(e.current_page_to_load>=e.page_count)){t.next=6;break}return t.abrupt("return");case 6:return t.t0=(n=e.photo_list).push,t.t1=n,t.t2=b["a"],t.next=11,_.get_secured_json(e.album_get_image_at_current_page_json_name);case 11:t.t3=t.sent,t.t4=(0,t.t2)(t.t3),t.t0.apply.call(t.t0,t.t1,t.t4),e.current_page_to_load++;case 15:case"end":return t.stop()}}),t)})))()},get_thumbnail_image:function(e,t){return"/api/album-cache/"+e+"/"+t},initialize:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.base_name){t.next=2;break}return t.abrupt("return");case 2:return e.current_page_to_load=0,e.photo_list=[],e.response_load_new=!0,e.initial_scroll_height=0,e.photo_count=e.page_count=0,t.next=9,_.get_secured_json(e.album_get_count_json_name);case 9:e.photo_count=t.sent.count,e.page_count=Math.ceil(e.photo_count/g),e.page_count>0&&e.load_image();case 12:case"end":return t.stop()}}),t)})))()},handleScroll:function(e){0===this.initial_scroll_height&&(this.initial_scroll_height=e.srcElement.scrollHeight/10),e.srcElement.offsetHeight+e.srcElement.scrollTop>=e.srcElement.scrollHeight-this.initial_scroll_height&&this.load_image()}}},k=y,x=Object(h["a"])(k,v,f,!1,null,"76c61232",null),S=x.exports,j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.showNavBar?"preview-with-navbar":"preview-hidden-navbar",staticStyle:{width:"100%",height:"100%"}},[n("span",{staticStyle:{position:"absolute",top:"45%","text-align":"center",color:"#888",display:"block",width:"100%"}},[e._v("正在加载图片...")]),n("div",{staticClass:"preview-photo-base preview-bg",style:e.preview_cache_img_style}),n("div",{staticClass:"preview-photo-high-res preview-bg",style:e.preview_img_style}),n("div",{staticClass:"preview-mask",on:{click:function(){e.showNavBar=!e.showNavBar}}}),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showNavBar,expression:"showNavBar"}],staticClass:"navbar",staticStyle:{width:"100% !important"}},[n("div",{staticClass:"nav-title"},[e._v(" "+e._s(e.photo_name)+" ")]),n("div",{staticClass:"left-button-group",on:{click:function(t){return e.raise_hide_preview()}}},[n("i",{staticClass:"larrow"}),n("span",{staticClass:"backtext"},[e._v(e._s(""===e.catalog_name?"相册列表":e.catalog_name))])]),n("div",{staticClass:"right-button-group"},[n("a",{attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.downloadPhoto()}}},[e._v("下载")])])])])},C=[],P=(n("b0c0"),n("ac1f"),n("5319"),n("8f6b"),{name:"Preview",props:["current_album_name","current_photo_filename","image_list","index","catalog_name","current_photo"],data:function(){return{showNavBar:!0,preview_img_style:{},preview_cache_img_style:{}}},computed:{photo_name:function(){return this.current_photo_filename.replace(/\.[a-z|A-Z|0-9]*$/g,"")},thumbnail_path:function(){return"/api/album-cache/".concat(this.current_album_name,"/").concat(this.current_photo_filename)},photo_path:function(){return"/api/album/".concat(this.current_album_name,"/").concat(this.current_photo_filename)}},methods:{raise_hide_preview:function(){this.$emit("hide-preview")},thumbnail_path_at_index:function(e){return"/api/album-cache/".concat(this.image_list[e].al,"/").concat(this.image_list[e].name)},photo_path_at_index:function(e){return"/api/album/".concat(this.image_list[e].al,"/").concat(this.image_list[e].name)},downloadPhoto:function(){window.open(this.photo_path)},getBackgroundSize:function(){var e=this.current_photo.h,t=this.current_photo.w,n=window.innerHeight,a=window.innerWidth,r=t/e,i=a/n,s=r-i,o="auto 100%",c="100% auto";return console.log(r,i),r>1?i>1?s>0?c:o:c:i>1?o:s>0?c:o}},watch:{current_photo:function(){this.preview_img_style={backgroundImage:"url('"+this.photo_path+"')",backgroundSize:this.getBackgroundSize()},this.preview_cache_img_style={backgroundImage:"url('"+this.thumbnail_path+"')",backgroundSize:this.getBackgroundSize()}}},mounted:function(){}}),E=P,N=Object(h["a"])(E,j,C,!1,null,"1346e270",null),O=N.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pwdi"},[n("div",{staticStyle:{position:"relative",height:"100%",width:"100%",margin:"0 0"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true || password_dialog_shown"}],staticClass:"dialog"},[n("div",{staticClass:"title"},[e._v(" 相册 ")]),n("div",{staticClass:"ctnt"},[e.passwordErrorMsgShown?n("p",{staticStyle:{color:"red"}},[e._v("密码错误，请重新输入！")]):n("p",[e._v("请输入密码以访问相册。")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.passwordEntered,expression:"passwordEntered"}],ref:"pi",attrs:{type:"password",placeholder:"密码"},domProps:{value:e.passwordEntered},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitPassword()},input:function(t){t.target.composing||(e.passwordEntered=t.target.value)}}}),n("div",{staticStyle:{"padding-top":"25px","text-align":"center"}},[n("button",{staticClass:"primary",staticStyle:{width:"100px"},attrs:{disabled:!e.password_dialog_shown},on:{click:function(t){return e.submitPassword()}}},[e._v("确定")])])])])])])},R=[],$=(n("a9fa"),n("8237")),I={name:"PasswordInput",data:function(){return{passwordErrorMsgShown:!1,passwordEntered:"",password_dialog_shown:!0,showInput:!0}},methods:{submitPassword:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.password_dialog_shown){t.next=2;break}return t.abrupt("return");case 2:if(console.log("submit password: ",$(e.passwordEntered)),""!==e.passwordEntered){t.next=5;break}return t.abrupt("return",e.$refs.pi.focus());case 5:e.password_dialog_shown=!1,e.$emit("submit-password",$(e.passwordEntered));case 7:case"end":return t.stop()}}),t)})))()},feedback:function(e){e||(this.password_dialog_shown=!0,this.passwordEntered="",this.passwordErrorMsgShown=!0)}},watch:{password_dialog_shown:function(){}},mounted:function(){this.$refs.pi.focus()}},B=I,z=Object(h["a"])(B,T,R,!1,null,"2e6cf5bf",null),A=z.exports,M=(n("8237"),{name:"App",components:{Sidebar:w,ContentView:S,Preview:O,PasswordInput:A},data:function(){return{activeName:"beautiful-album",content_view_shown:!0,sidebar_shown_on_mobile_mode:!1,sidebar_shown_on_pc_mode:!0,password_input_shown:!1,preview_shown:!1,preview_filename:"",preview_imagelist:[],preview_index:0,preview_album_name:"",preview_current_obj:"",contentAlbumName:"",contentFriendlyName:""}},methods:{previewPhoto:function(e,t,n,a,r){this.preview_filename=e,this.preview_index=n,this.preview_imagelist=t,this.preview_album_name=a,this.preview_current_obj=r,this.preview_shown=!0},requirePassword:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.password_input_shown=!0;case 1:case"end":return t.stop()}}),t)})))()},checkPassword:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return window.miyuki_password=e,window.enabled_password=!0,n.prev=2,n.next=5,_.get_secured_json("get-album");case 5:localStorage.setItem("password",e),t.$refs.password_input.feedback(!0),t.password_input_shown=!1,t.initialize(),n.next=16;break;case 11:n.prev=11,n.t0=n["catch"](2),localStorage.removeItem("password"),t.requirePassword(),t.$refs.password_input.feedback(!1);case 16:case"end":return n.stop()}}),n,null,[[2,11]])})))()},initialize:function(){this.$refs.sidebar.getAlbumList(),this.contentAlbumName="/all",this.contentFriendlyName="图库"}},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.innerWidth<=500&&(e.sidebar_shown_on_mobile_mode=!0),t.next=3,_.get_json("password");case 3:n=t.sent,n=n.enabled,!0,n?null!==localStorage.getItem("password")?e.checkPassword(localStorage.getItem("password")):e.requirePassword():(window.enabled_password=!1,e.initialize());case 7:case"end":return t.stop()}}),t)})))()}}),F=M,H=(n("034f"),Object(h["a"])(F,r,i,!1,null,null,null)),q=H.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(q)}}).$mount("#app")},"85ec":function(e,t,n){},"8f6b":function(e,t,n){},a9fa:function(e,t,n){},bfe0:function(e,t,n){},eacf:function(e,t,n){},f33e:function(e,t,n){}});
//# sourceMappingURL=app.36dc8688.js.map